version: '3'

services:
  nginx:
    build:
      context: .docker/nginx
      dockerfile: Dockerfile
    ports:
      - "80:80"
    volumes:
      - ./.docker/nginx/hosts/balancer.conf:/etc/nginx/conf.d/default.conf
      - ./logs:/var/log/nginx
    container_name: balancer
    networks:
      - app-network

  nginx-main:
    build:
      context: .docker/nginx
      dockerfile: Dockerfile
    volumes:
      - ./src:/www/application.local
      - ./.docker/nginx/hosts/main.conf:/etc/nginx/conf.d/default.conf
      - ./logs:/var/log/nginx
      - ./run:/var/run/
    container_name: nginx-primary
    networks:
      - app-network

  nginx-second:
    build:
      context: .docker/nginx
      dockerfile: Dockerfile
    volumes:
      - ./src:/www/application.local
      - ./.docker/nginx/hosts/second.conf:/etc/nginx/conf.d/default.conf
      - ./logs:/var/log/nginx
      - ./run:/var/run/
    container_name: nginx-secondary
    networks:
      - app-network

  php-first:
    build:
      context: .docker/php
      dockerfile: Dockerfile
      args:
        - SERVER_NUMBER=first
    container_name: php-first
    volumes:
      - ./src:/www/application.local
      - ./run:/var/run/
    networks:
      - app-network

  php-second:
    build:
      context: .docker/php
      dockerfile: Dockerfile
      args:
        - SERVER_NUMBER=second
    container_name: php-second
    volumes:
      - ./src:/www/application.local
      - ./run:/var/run/
    networks:
      - app-network

  memcached:
    image: bitnami/memcached:latest
    ports:
      - "11211:11211"
    networks:
      - app-network

networks:
  app-network:
    driver: bridge