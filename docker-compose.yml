version: '3.8'

services:
  balancer:
    build:
      context: .
      dockerfile: ./dockerfiles/nginx/Dockerfile
    image: balancer/balancer
    container_name: balancer
    ports:
      - 80:80
    volumes:
      - ./dockerfiles/nginx/balancer.conf:/etc/nginx/conf.d/default.conf
      - ./mysite.local:/var/www
      - ./logs:/var/log/nginx
    networks:
      default:

  nginx1:
    build:
      context: .
      dockerfile: ./dockerfiles/nginx/Dockerfile
    image: balancer/nginx1
    container_name: first_nginx
    depends_on:
      - php1
    volumes:
      - ./dockerfiles/nginx/nginx.conf:/etc/nginx/conf.d/default.conf
      - ./mysite.local:/var/www
      - ./logs:/var/log/nginx
    networks:
      default:

  php1:
    build:
      context: .
      dockerfile: ./dockerfiles/Dockerfile
    image: balancer/php-first
    container_name: first-php-fpm
    volumes:
      - .:/var/www
    networks:
      default:

  nginx2:
    build:
      context: .
      dockerfile: ./dockerfiles/nginx/Dockerfile
    image: balancer/nginx2
    container_name: second_nginx
    depends_on:
      - php2
    volumes:
      - ./dockerfiles/nginx/nginx.conf:/etc/nginx/conf.d/default.conf
      - ./mysite.local:/var/www
      - ./logs:/var/log/nginx
    networks:
      default:

  php2:
    build:
      context: .
      dockerfile: ./dockerfiles/Dockerfile
    image: balancer/php-second
    container_name: second-php-fpm
    volumes:
      - .:/var/www
    networks:
      default:

  nginx3:
    build:
      context: .
      dockerfile: ./dockerfiles/nginx/Dockerfile
    image: balancer/nginx3
    container_name: third_nginx
    depends_on:
      - php3
    volumes:
      - ./dockerfiles/nginx/nginx.conf:/etc/nginx/conf.d/default.conf
      - ./mysite.local:/var/www
      - ./logs:/var/log/nginx
    networks:
      default:

  php3:
    build:
      context: .
      dockerfile: ./dockerfiles/Dockerfile
    image: balancer/php-third
    container_name: third-php-fpm
    volumes:
      - .:/var/www
    networks:
      default:

  memcached:
    container_name: memcached
    image: memcached:latest
    ports:
      - 11211:11211
    networks:
      default:

networks:
  default:
    name: myNetwork
    driver: bridge