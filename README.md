# PHP_2022 Домашнее задание №10 (Занятие №12, ElasticSearch)

# Автор
Mikhail Ikonnikov <mishaikon@gmail.com>

# Курс
Otus PHP Professional: https://fas.st/wRyRs

# Задание
- реализуем поиск по книжному интернет-магазину с помощью Elasticsearch
- у каждого товара есть название, категория, цена и кол-во остатков на складе
- поиск должен корректно работать с опечатками и русской морфологией
- пример: пользователь ищет все исторические романы дешевле 2000 рублей (и в наличии) по поисковому запросу “рыцОри”
- в результате должны вернуться товары, ранжированные по релевантности
- домашку нужно сдать как консольное PHP-приложение, которое принимает один или несколько параметров командной строки и
  выводит результат в виде текстовой таблички, после чего завершает работу
- JSON с товарами будет приложен к занятию в ЛК
- способ создания индекса и его первоначального заполнения — на ваш выбор

# Установка приложения
```
git clone https://github.com/otusteamedu/PHP_2022/
cd PHP_2022
git checkout MIkonnikov_hw12
cd code
composer install
composer update
```

# Настройка приложения
Добавить в hosts Запись вида:
```
127.0.0.1 mysite.local
```

# Запуск приложения 
Запуск из корня проекта
```
docker-compose build 
docker-compose up -d
```

# Проверка
В браузере открыть URL:
http://mysite.local

# Импорт данных 
Залить тестовые данные в Elasticsearch командой:
```
curl -XPOST 'http://mysite.local:9200/_bulk' -H "Content-Type: application/json" --data-binary @books.json
```

# Тест поиска 
После запуска контейнера зайти в php-fpm и запустить поиск:
```
docker exec -it php-fpm_hw10 bash
php /data/mysite.local/index/index.php "рыцОри"
```

Ожидаемый результат:
```
+----+--------------+------------------------------------------------+--------------------+-------+---------------------+
| #  | SKU          | Название                                       | Категория          | Цена  | Наличие             |
+----+--------------+------------------------------------------------+--------------------+-------+---------------------+
| 1  | 500-000      | Кто подставил поручика Ржевского на Луне       | Исторический роман | 3761  | Мира: 17, Ленина: 1 |
| 2  | 500-001      | Кто подставил Терминатора в домашних условиях  | Искусство          | 8615  | Мира: 9, Ленина: 12 |
| 3  | 500-002      | Приключения рептилоидов по ночам               | Исторический роман | 2065  | Мира: 16, Ленина: 16|
| 4  | 500-003      | Советы по выращиванию рептилоидов в Москве     | Детектив           | 2947  | Мира: 7, Ленина: 8  |
| 5  | 500-004      | Что делали рыцари поручика Ржевского в Москве  | Детектив           | 4620  | Мира: 1, Ленина: 6  |
| 6  | 500-005      | Советы по выращиванию рептилоидов под мухой    | Фантастика         | 7538  | Мира: 13, Ленина: 10|
| 7  | 500-006      | Советы по выращиванию рептилоидов под кроватью | Искусство          | 4247  | Мира: 8, Ленина: 20 |
| 8  | 500-007      | Что делали рыцари поручика Ржевского по ночам  | Любовный роман     | 1572  | Мира: 5, Ленина: 2  |
| 9  | 500-008      | Жуткие преступления рептилоидов за границей    | Фантастика         | 4807  | Мира: 6, Ленина: 0  |
| 10 | 500-009      | Кто подставил Штирлица в домашних условиях     | Детектив           | 9447  | Мира: 15, Ленина: 10|
+----+--------------+------------------------------------------------+--------------------+-------+---------------------+
```