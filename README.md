# Что это?

Мое домашнее задание к уроку №11 
("Как устроен PostgreSQL") по курсу "Otus PHP Professonal"

Подробнее о курсе:
https://fas.st/wRyRs

# Автор
Mikhail Ikonnikov <mishaikon@gmail.com>

# Тема 
Индексирование данных

# Цель 
Научиться повышать производительность сервера БД на уровне администрирования настроек.

# Задание

## Описание/Пошаговая инструкция выполнения домашнего задания
(!) В БД из предыдущего д/з (“Кинотеатры“):

Подготовить список из 6 основных запросов к БД, разработанной на предыдущих занятиях.

Целесообразно выбрать:

* "простых" (задействована 1 таблица),

* "сложных" (агрегатные функции, связи таблиц).

(!) Написать скрипт/sql-запрос для наполнения основных таблиц БД тестовыми данными.

* Заполнить таблицы, увеличив общее количество строк текстовых данных до 10000.

* Провести анализ производительности запросов к БД, сохранить планы выполнения.

* Заполнить таблицы, увеличив общее количество строк текстовых данных до 10000000.

* Провести анализ производительности запросов к БД, сохранить планы выполнения.

* На основе анализа запросов и планов предложить оптимизации (индексы, структура, параметры и др.), выполнить их, сравнить результат (планы выполнения).



## Результат
* скрипт создания БД (с предыдущих занятий)
* скрипт заполнения БД тестовыми данными
* таблица с результатами по каждому из 6 запросов
* запрос
* план на БД:
  * до 10000 строк
  * до 10000000 строк
  * до 10000000 строк
* что удалось улучшить
* перечень оптимизаций с пояснениями
* отсортированный список (15 значений) самых больших по размеру объектов БД (таблицы, включая индексы, сами индексы)
* отсортированные списки (по 5 значений) самых часто и редко используемых индексов

## РЕШЕНИЕ
Выполняем команды в консоли, смотрим результат:
(*) аналитику вынес в отдельный файл - см. otus_hw11_analytics.pdf
```
# run postgres client in console
pgsql

# 1. load old DB dump (see 'hw8_cinema_db')
\i 1_create_cinema_db.sql

# 2. load applied functions
\i 2_functions.sql

# 3. load data (small dump)
\i 3_fill_db_small.sql

# 4. exec analyze of simple queries 
\i 4_simple_queries.sql

# 5. exec analyze of hard queries 
\i 5_hard_queries.sql

# repeat steps 3-5 for other data dumps:
\i 3_fill_db_medium.sql
\i 4_simple_queries.sql
\i 5_hard_queries.sql

\i 3_fill_db_large.sql
\i 4_simple_queries.sql
\i 5_hard_queries.sql

# analyze outputs

# 6. get top large objects
\i 6_top_large_objects.sql

# 7. get mosy used indexes
\i 7_top_used_indexes.sql 
```