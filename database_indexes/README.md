# Анализ производительности БД. Планы оптимизации.

### Выполнение запросов к БД на 10000 записей в таблицах:

В базе данных с таблицами (билеты и сеансы) на ~10000 записей результаты запросов следующие:

- Простые запросы в среднем выполняются 77 ms
- Сложные запросы в среднем выполняются 126 ms

### Выполнение запросов к БД на 1000000 записей в таблицах:

В базе данных с таблицами (билеты и сеансы) на ~1000000 записей результаты запросов следующие:

Из простых запросов самым трудозатратным оказался запрос на получение самого прибыльного фильма.
Его время выполнения в среднем составляет 15-17 секунд.
Время выполнения двух следующих простых запросов в среднем составляет 560 ms.

При выполнении сложных запросов самым трудозатратным получился запрос на получение списка проданных билетов за все время.
Его время выполнение составило в среднем 55-60 секунд.
Время выполнения двух других запросов в среднем составило 159 ms

### Оптимизация запросов

#### План оптимизации запросов

План оптимизации проведем на примере БД с ~ 1000000 записей, так как в этом случае разница до и после оптимизации будет более наглядна.

Рассмотрим два наиболее трудозатратных запроса:
- простой запрос на получение самого прибыльного фильма
- сложный запрос на получение списка проданных билетов за все время

Для оптимизации запросов необходимо добавить индексы к таблице сеансов (поля hall_id, film_id) и к таблице билетов (поле film_session_id).

```genericsql
CREATE INDEX film_session_index ON film_session (hall_id, film_id);
CREATE INDEX ticket_index ON ticket (film_session_id);
```

#### Результаты

- После добавления индексов время выполнения запроса на получение самого прибыльного фильма составило ~ 1 секунду (против 15-17 секунд без индексов)
- После добавления индексов время выполнения запроса на получение списка проданных билетов в среднем составило 33 секунды, что практически в два раза быстрее, чем до оптимизации.

#### Дополнительно

Запрос на получение списка из 15 самых больших по размеру объектов БД расположен в файле psql_objects.sql
