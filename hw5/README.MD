# Что это?
"OTUS PHP Pro" course: https://fas.st/wRyRs 
Lesson #5: Webservers, homework

# Автор
Ikonnikov Mikhail <mishaikon@gmail.com>

##############################

# Задача

Описание/пошаговая инструкция выполнения домашнего задания

Задача: Верификация строки со скобками

Используя Docker, вы описали сборку двух контейнеров:
- один с nginx,
- второй – с php-fpm и вашим кодом.

Используя docker-compose вы запускаете оба контейнера.
Контейнер с nginx пробрасывает 80 порт на вашу хостовую машину и ожидает соединений.
Клиент соединяется, и шлёт следующий HTTP-запрос:
```
POST / HTTP/1.1
string=(()()()()))((((()()()))(()()()(((()))))))
```
String - это POST-параметр, который можно проверять:
- На непустоту
- На корректность кол-ва открытых и закрытых скобок

Все запросы с динамическим содержимым (*.php) nginx, 
используя директиву fastcgi_pass, проксирует в контейнер с php-fpm и вашим кодом.

Nginx должен обрабатывать запросы не обращая внимания на директиву Host.

После обработки:
- если строка корректна, то пользователю возвращается ответ 200 OK, с информационным текстом, что всё хорошо;
- если строка некорректна, то пользователю возвращается ответ 400 Bad Request, с информационным текстом, что всё плохо.

Создать балансируемый кластер
- Балансировщик nginx-upstream
- Балансируемые бэкенды на nginx (у каждого свой php-fpm, в идеале - можно запрашивать любой доступный fpm)
- Подключите к обоим контейнерам fpm контейнер с Memcache
- Если у Вас есть балансировка, стандартными сессиями уже не обойтись. Иначе не будет работать аутентификация. Переведите хранение сессий в него (Memcache)
- Усложнённая задача для тех, кто хочет проверить свои силы: объедините оба Memcache в кластер. Можно использовать Repcached

Критерии оценки
- Строка в примере - только пример. На тестах она должна быть любой
- Соответствие скобок должно быть и с точки зрения скобок. Тест ")(" не должен проходить
- Конструкции @ и die неприемлемы. Вместо них используйте исключения
- С точки зрения логики веб-сервиса ответ 400 - это валидное завершение работы скрипта

##############################

# Настройка/запуск

## write to hosts file:
```
127.0.0.1 hw5
```

### goto workdir 
```
cd ./hw5
```

### build containers
```
docker-compose build
```

### exec containers
```
docker-compose up
```

### open in browser
```
http://hw5:8083/
```

### send postman request
- URL: http://hw5:8083/
- params: string: ())

### get result (example):
- connection →keep-alive
- content-type →text/html; charset=UTF-8
- date →Fri, 19 Aug 2022 09:41:49 GMT
- fail →icorrect string (Response from 83e503a64f67)
- server →nginx/1.21.6
- transfer-encoding →chunked
- x-powered-by →PHP/7.4.30

### stop containers
```
docker-compose down
```

##############################
