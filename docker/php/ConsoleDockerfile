FROM php:8.0-cli

ENV BASE_PATH="/var/www" \
    MODE="production" \
    PATH=/composer/vendor/bin:/scripts:/scripts/aliases:$PATH \
    COMPOSER_ALLOW_SUPERUSER=1 \
    COMPOSER_CACHE_DIR="/tmp" \
    COMPOSER_HOME="/composer" \
    XDEBUG_CLIENT_HOST="172.17.0.1"

RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    zip \
    unzip \
    libz-dev libmemcached-dev  \
    && pecl install memcached  \
    && docker-php-ext-enable memcached \
    && pecl install redis-5.3.7 \
    && docker-php-ext-enable redis

RUN curl -sS https://getcomposer.org/installer | php -- --filename=composer --install-dir=/usr/local/bin

COPY docker/php/php.ini /usr/local/etc/php/conf.d/php-custom.ini

WORKDIR /var/www