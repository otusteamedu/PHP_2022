<?php

require_once("EmailValidator.class.php");

$IN_FILE = "emails.txt";
$OUT_FILE = "valid_emails.txt";

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// START

echo "START emails filtering ...\n";

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Input emails

$fp = fopen($IN_FILE, "r");
if (!$fp) {
    die("Error: cannot read file: $IN_FILE\n");
}
while (($buffer = fgets($fp, 4096)) !== false) {
    $emails[] = trim($buffer);
}
if (!feof($fp)) {
    echo "Error: fgets() failed\n";
}
fclose($fp);

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Validate emails

$validator = new EmailValidator();
$emails = $validator->filterEmailsList($emails);

$fp = fopen($OUT_FILE, "w");
if (!$fp) {
    die("Error: cannot write to file: $OUT_FILE\n");
}

foreach ($emails as $email) {
    fwrite($fp, $email . "\n");
}

fclose($fp);

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// End

echo "FINISH, see results in $OUT_FILE.\n";

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
